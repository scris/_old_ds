---
layout:     post
title:      Electron 的 Windows 通知问题
permalink:  /cd2enotify/
date:       2019-07-09 21:48:33
summary:   The record of the couple of days before the exciting fix
categories: switchable 笔记 cordova electron
---
### 技术栈
Vue（Cli 3） => Cordova 9 => cordova-electron 1.1.0 => electron-builder 20
<br> **注：** cordova-electron 1.0.2 对于 icon 处理有问题，请您一定使用 1.1.0

当然，其实本文对原生 electron 以及 electron-vue 也有意义。

### 1. Electron 原生方案
默认的 WebAPI 语法极为简单：

``` javascript
var notification = new Notification(title, {
	body: message,
	icon: require("@/assets/notifyicon.png"),
});
```
然而，由于一些官方文档也写明了的原因，在 Windows 下这并不可用，你不会收到错误，但不显示通知。需要配置AppID才可以，我没有配置成功。（添加了多处，但没有起效果，*有谁成功的可以在底下留言一下谢谢*）当然也不排除是 cordova-electron 的 bug。

### 2. Node-Notifier 这个第三方方案

发生了一个问题 `net.connect is not a function`, 我尝试了两天一无所获，提的 issue 无人理睬（毕竟是个人开发者的项目）。

 [我的 issue 的地址](https://github.com/mikaelbr/node-notifier/issues/280)
 
### 3. 迫不得已，手动模拟窗口

其实还有一条路可走： elctron 的 `dialog` ，但不喜欢，所以手动用窗口模拟。这里的坑点仍然很多，详见下文。

cordova-electron 的 Main 很局促 （`/platforms/electron/platform_www/cdv-electron-main.js`），更新 platform 还会覆盖， 所以用了一种尽量用 Renderer 的模式渲染窗口（工作量差不多）。

``` javascript	
const { remote } = window.electron //这里原因是非 electron 环境不能直接用 electron， 用法见下文
const { BrowserWindow } = remote //放在 export default 外面貌似不行，欢迎交流
const path = require('path')
localStorage.setItem('nftitle', title);//把信息传递到另一个页面的其中一个方法
localStorage.setItem('nfmessage', message);//注意因为是两个窗口，vuex貌似不可以用
let notifyWin = new BrowserWindow({
    frame: false,
    width: 400,
    height: 300,
    webPreferences: {
        nodeIntegration: true,
        webSecurity: false,
    },
});
notifyWin.loadURL(window.location.href + 'notifypage');//这里有来头，用法见下文
notifyWin.on('closed', () => {
    notifyWin = null
});
notifyWin.show();
notifyWin.focus();//让用户收到通知，也可以用 alwaysOnTop 来处理
```
**window.electron**

未完待续

**loadURL**

未完待续（包括解释、router代码、notifypage代码）

这样就可以完成一个窗口的手动模拟了，也可以当作 Windows 下 electron 通知的一个非常可行的解决方案。